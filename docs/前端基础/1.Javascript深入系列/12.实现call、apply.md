---
title: '实现call、apply'
date: 2020-03-26
permalink: 'js_deep/call_apply'
tag:
  - javascript基础系列
categories:
  - javascript基础系列
---

## 实现call

- 要在挂载的对象 context 上临时加一个方法 fn
- 用 eval 执行这个临时添加的函数 fn，并拿到执行结果 result
- 删除临时函数 fn，并返回执行结果 result

```js
Function.prototype.call = function(context) {
  if (typeof context === 'object') {
    context = context || window // context如果是 null 就会赋值为window
  } else {
    context = Object.create(null)
  }

  // 在 context 下挂载一个对象，函数所在的 key 随机生成，防止 context 上有同名的 key
  // 使用ES6 Symbol 也可以
  var fn = +new Date() + '' + Math.random()
  context[fn] = this

  var args = []
  for (var i = 1; i < arguments.length; i++) {
    args.push('arguments['+ i +']')
  }

  var result = eval('context.fn(' + args +')')
  delete context[fn]

  return result;
}
```

## 实现apply

apply 的实现和 call 类似，区别在于入参不一样，apply用数组传，call则要一个个传

```js
Function.prototype.apply = function(context, array) {
  if (typeof context === 'object') {
    context = context || window
  } else {
    context = Object.create(null)
  }

  var fn = +new Date() + '' + Math.random()
  context[fn] = this

  var args = []
  if(array) {
    for(var i = 0; i < array.length; i++) {
      args.push('array['+ i +']')
    }
  }

  var result = eval('context.fn('+ args +')')
  delete context[fn]

  return result
}
```
