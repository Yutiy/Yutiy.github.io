---
title: '深浅拷贝'
date: 2020-03-26
permalink: 'js_topic/depth_copy'
tag:
  - javascript专题系列
categories:
  - javascript专题系列
---

## 实现

```js
const getType = function(data) {
  const baseType = Object.prototype.toString
    .call(data)
    .replace(/^\[object\s(.+)\]$/g, '$1')
    .toLowerCase();
  const type = data instanceof Element ? 'element' : baseType;
  return type;
}

const isPrimitive = function(data) {
  // 简单列一下部分基本数据类型
  const primitiveType = 'undefined,null,boolean,string,symbol,number,bigint,map,set,weakmap,weakset'.split(',');
  return primitiveType.includes(getType(data));
}
const isObject = data => getType(data) === 'object';
const isArray = data => getType(data) === 'array';

const deepClone = function(data) {
  let cache = {};
  const baseClone = function (_data) {
    let res;
    if (isPrimitive(_data)) {
      return data;
    } else if (isObject(_data)) {
      res { ...data };
    } else if (isArray(_data)) {
      res [...data];
    }

    // 判断是否有复杂类型的数据，有则递归
    Reflect.ownKeys(res).forEach(key => {
      if (res[key] && getType(res[key]) === 'object') {
        if (cache[res[key]]) {
          res[key] = cache(res[key]);
        } else {
          cache[res[key]] = res[key];
          res[key] = baseClone(res[key]);
        }
      }
    })

    return res;
  }

  return baseClone(data);
}
```
