---
title: '进制转换'
date: 2020-03-26
permalink: 'js_topic/base_transform'
tag:
  - javascript专题系列
categories:
  - javascript专题系列
---

## 进制转换

解决 `0.1 + 0.2 = 0.3?` 问题

### 二进制如何转换为十进制

例如二进制 101.1 如何转换为十进制，有些同学可能会想到 `parseInt('101.1', 2)`, 但是 parseInt 会返回整数，所以是不对的。转化方法如下:

> 101.1 -> 1 * 2^2 + 0 * 2^1 + 1 * 2^0 + 1 * 2^-1 = 5.5

转换规则如下: **二进制的每个数乘上 2 的相应次方，小数点后是乘上 -2 的相应次方**

### 十进制转换为二进制

JS里面可以使用 `toString(2)` 这个方法来进行转换，如 `29..toString(2) -> '11101'`，其算法如下:

- 把给定的十进制数29除以2，商为14，所得的余数1是二进制数的最低位的数码
- 再将14除以2，商为7，余数为0
- 再将7除以2，商为3，余数为1，再将3除以2，商为1，余数为1
- 再将1除以2，商为0，余数为1是二进制数的最高位的数码

### 十进制小数转换为二进制

方式是采用 **乘2取整，顺序排列** 法。具体做法是：

- 用2乘十进制小数，可以得到积，将积的整数部分取出-
- 再用2乘余下的小数部分，又得到一个积，再将积的整数部分取出
- 如此进行，直到积中的小数部分为零，或者达到所要求的精度为止

**举个例子🌰**，十进制 0.25 转为二进制:

- `0.25 * 2 = 0.5`, 取出整数部分 0
- `0.5 * 2 = 1.0`, 取出整数部分 1

即十进制 0.25 转为二进制为 `0.01`（第一次所得到为最高位,最后一次得到为最低位）

此时我们可以试试十进制 0.1 和 0.2 如何转为二进制:

```bash
# 0.1计算
0.1(十进制) = 0.0001100110011001(二进制)

十进制数0.1转二进制计算过程：
0.1*2＝0.2……0 ——> 整数部分为0。整数部分0清零后为0，用0.2接着计算。
0.2*2＝0.4……0 ——> 整数部分为0。整数部分0清零后为0，用0.4接着计算。
0.4*2＝0.8……0 ——> 整数部分为0。整数部分0清零后为0，用0.8接着计算。
0.8*2＝1.6……1 ——> 整数部分为1。整数部分1清零后为0，用0.6接着计算。
0.6*2＝1.2……1 ——> 整数部分为1。整数部分1清零后为0，用0.2接着计算。
0.2*2＝0.4……0 ——> 整数部分为0。整数部分0清零后为0，用0.4接着计算。
0.4*2＝0.8……0 ——> 整数部分为0。整数部分0清零后为0，用0.8接着计算。
0.8*2＝1.6……1 ——> 整数部分为1。整数部分1清零后为0，用0.6接着计算。
0.6*2＝1.2……1 ——> 整数部分为1。整数部分1清零后为0，用0.2接着计算。
0.2*2＝0.4……0 ——> 整数部分为0。整数部分0清零后为0，用0.4接着计算。
0.4*2＝0.8……0 ——> 整数部分为0。整数部分0清零后为0，用0.2接着计算。
0.8*2＝1.6……1 ——> 整数部分为1。整数部分1清零后为0，用0.2接着计算。
……
……

所以，得到的整数依次是：0，0，0，1，1，0，0，1，1，0，0，1……。
由此，大家肯定能看出来，整数部分出现了无限循环

# 0.2计算
0.2(十进制) = 0.00110011001100110011(二进制)

0.2*2=0.4 整数位为0
0.4*2=0.8 整数位为0
0.8*2=1.6 整数位为1,去掉整数位得0.6
0.6*2=1.2 整数位为1,去掉整数位得0.2
0.2*2=0.4 整数位为0
0.4*2=0.8 整数位为0

就这样推下去！小数*2整,一直下去就行，这个数整不断
```

所以 `0.1` 和 `0.2` 都无法完美转换为十进制，所以相加得到的结果当然不是 `0.3` 了。
