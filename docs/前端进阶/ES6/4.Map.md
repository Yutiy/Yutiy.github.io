---
title: 'Map'
date: 2020-03-26
permalink: 'es6/map'
tag:
  - ES6
categories:
  - ES6
---

## å­—å…¸Map

**åªæœ‰å¯¹åŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼ŒMap ç»“æ„æ‰å°†å…¶è§†ä¸ºåŒä¸€ä¸ªé”®ã€‚è¿™ä¸€ç‚¹è¦éå¸¸å°å¿ƒã€‚**

```js
const map = new Map()

map.set(['a'], 555)
map.get(['a']) // undefined
```

å¦‚æœ Map çš„é”®æ˜¯ä¸€ä¸ªç®€å•ç±»å‹çš„å€¼ï¼ˆæ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ï¼‰ï¼Œåˆ™åªè¦ä¸¤ä¸ªå€¼ä¸¥æ ¼ç›¸ç­‰ï¼ŒMap å°†å…¶è§†ä¸ºä¸€ä¸ªé”®ï¼Œæ¯”å¦‚0å’Œ-0å°±æ˜¯ä¸€ä¸ªé”®ï¼Œå¸ƒå°”å€¼trueå’Œå­—ç¬¦ä¸²trueåˆ™æ˜¯ä¸¤ä¸ªä¸åŒçš„é”®ã€‚å¦å¤–ï¼Œundefinedå’Œnullä¹Ÿæ˜¯ä¸¤ä¸ªä¸åŒçš„é”®ã€‚è™½ç„¶NaNä¸ä¸¥æ ¼ç›¸ç­‰äºè‡ªèº«ï¼Œä½† Map å°†å…¶è§†ä¸ºåŒä¸€ä¸ªé”®ã€‚

```js
let map = new Map()

map.set(-0, 123)
map.get(+0) // 123

map.set(true, 1)
map.set('true', 2)
map.get(true) // 1

map.set(undefined, 3)
map.set(null, 4)
map.get(undefined) // 3

map.set(NaN, 123)
map.get(NaN) // 123
```

### å±æ€§

- constructorï¼šæ„é€ å‡½æ•°
- sizeï¼šè¿”å›å­—å…¸ä¸­æ‰€åŒ…å«çš„å…ƒç´ ä¸ªæ•°

```js
const map = new Map([
  ['name', 'Yutiy'],
  ['like', 'Front']
])
map.size // 2
```

### æ–¹æ³•

æ“ä½œæ–¹æ³•ï¼š

- set(key, value)ï¼šå‘å­—å…¸ä¸­æ·»åŠ æ–°å…ƒç´ 
- get(key)ï¼šé€šè¿‡é”®æŸ¥æ‰¾ç‰¹å®šçš„æ•°å€¼å¹¶è¿”å›
- has(key)ï¼šåˆ¤æ–­å­—å…¸ä¸­æ˜¯å¦å­˜åœ¨é”®key
- delete(key)ï¼šé€šè¿‡é”® key ä»å­—å…¸ä¸­ç§»é™¤å¯¹åº”çš„æ•°æ®
- clear()ï¼šå°†è¿™ä¸ªå­—å…¸ä¸­çš„æ‰€æœ‰å…ƒç´ åˆ é™¤

éå†æ–¹æ³•

- keys()ï¼šå°†å­—å…¸ä¸­åŒ…å«çš„æ‰€æœ‰é”®åä»¥è¿­ä»£å™¨å½¢å¼è¿”å›
- values()ï¼šå°†å­—å…¸ä¸­åŒ…å«çš„æ‰€æœ‰æ•°å€¼ä»¥è¿­ä»£å™¨å½¢å¼è¿”å›
- entries()ï¼šè¿”å›æ‰€æœ‰æˆå‘˜çš„è¿­ä»£å™¨
- forEach()ï¼šéå†å­—å…¸çš„æ‰€æœ‰æˆå‘˜

```js
const map = new Map([
  ['name', 'Yutiy'],
  ['like', 'Front']
]);

console.log(map.entries()) // MapIteratorÂ {"name" => "Yutiy", "like" => "Front"}
console.log(map.keys()) // MapIteratorÂ {"name", "like"}
```

Map ç»“æ„çš„é»˜è®¤éå†å™¨æ¥å£ï¼ˆSymbol.iteratorå±æ€§ï¼‰ï¼Œå°±æ˜¯entriesæ–¹æ³•ã€‚

```js
map[Symbol.iterator] === map.entries // true
```

Map ç»“æ„è½¬ä¸ºæ•°ç»„ç»“æ„ï¼Œæ¯”è¾ƒå¿«é€Ÿçš„æ–¹æ³•æ˜¯ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ï¼ˆ...ï¼‰ã€‚ä¸¾ä¸ªğŸŒ°ï¼š

```js
const reporter = {
  report: function(key, value) {
    console.log("Key: %s, Value: %s", key, value)
  }
};

let map = new Map([
  ['name', 'Yutiy'],
  ['like', 'Front']
])
map.forEach(function(value, key, map) {
  this.report(key, value);
}, reporter);

// Key: name, Value: Yutiy
// Key: like, Value: Front
```

> ä¸å…¶ä»–æ•°æ®ç»“æ„çš„ç›¸äº’è½¬æ¢

1. **Map è½¬ Array**

```js
const map = new Map([[1, 1], [2, 2], [3, 3]])
console.log([...map])	// [[1, 1], [2, 2], [3, 3]]
```

2. **Array è½¬ Map**

```js
const map = new Map([[1, 1], [2, 2], [3, 3]])
console.log(map)	// Map {1 => 1, 2 => 2, 3 => 3}
```

3. **Map è½¬ Object**

å› ä¸º Object çš„é”®åéƒ½ä¸ºå­—ç¬¦ä¸²ï¼Œè€ŒMap çš„é”®åä¸ºå¯¹è±¡ï¼Œæ‰€ä»¥è½¬æ¢çš„æ—¶å€™ä¼šæŠŠéå­—ç¬¦ä¸²é”®åè½¬æ¢ä¸ºå­—ç¬¦ä¸²é”®åã€‚

```js
function mapToObj(map) {
  let obj = Object.create(null)
  for (let [key, value] of map) {
    obj[key] = value
  }
  return obj
}
const map = new Map().set('name', 'Yutiy').set('like', 'Front')
mapToObj(map) // {name: "Yutiy", like: "Front"}
```

4. **Object è½¬ Map**

```js
function objToMap(obj) {
  let map = new Map()
  for (let key of Object.keys(obj)) {
    map.set(key, obj[key])
  }
  return map
}

objToMap({'name': 'Yutiy', 'like': 'Front'}) // Map {"name" => "An", "des" => "JS"}
```

5. **Map è½¬ JSON**

```js
function mapToJson(map) {
  return JSON.stringify([...map])
}

let map = new Map().set('name', 'Yutiy').set('like', 'Front')
mapToJson(map) // [["name","An"],["des","JS"]]
```

6. **JSON è½¬ Map**

```js
function jsonToStrMap(jsonStr) {
  return objToMap(JSON.parse(jsonStr));
}
jsonToStrMap('{"name": "Yutiy", "like": "Front"}') // Map {"name" => "An", "des" => "JS"}
```

## WeakMap

> WeakMap å¯¹è±¡æ˜¯ä¸€ç»„é”®å€¼å¯¹çš„é›†åˆï¼Œå…¶ä¸­çš„é”®æ˜¯å¼±å¼•ç”¨å¯¹è±¡ï¼Œè€Œå€¼å¯ä»¥æ˜¯ä»»æ„ã€‚

**WeakMap å¼±å¼•ç”¨çš„åªæ˜¯é”®åï¼Œè€Œä¸æ˜¯é”®å€¼ã€‚é”®å€¼ä¾ç„¶æ˜¯æ­£å¸¸å¼•ç”¨ã€‚**

WeakMap ä¸­ï¼Œæ¯ä¸ªé”®å¯¹è‡ªå·±æ‰€å¼•ç”¨å¯¹è±¡çš„å¼•ç”¨éƒ½æ˜¯å¼±å¼•ç”¨ï¼Œåœ¨æ²¡æœ‰å…¶ä»–å¼•ç”¨å’Œè¯¥é”®å¼•ç”¨åŒä¸€å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°†ä¼šè¢«åƒåœ¾å›æ”¶ï¼ˆç›¸åº”çš„keyåˆ™å˜æˆæ— æ•ˆçš„ï¼‰ï¼Œæ‰€ä»¥ï¼ŒWeakMap çš„ key æ˜¯ä¸å¯æšä¸¾çš„ã€‚

### å±æ€§ï¼š

- constructorï¼šæ„é€ å‡½æ•°

### æ–¹æ³•ï¼š

- has(key)ï¼šåˆ¤æ–­æ˜¯å¦æœ‰ key å…³è”å¯¹è±¡
- get(key)ï¼šè¿”å›keyå…³è”å¯¹è±¡ï¼ˆæ²¡æœ‰åˆ™åˆ™è¿”å› undefinedï¼‰
- set(key)ï¼šè®¾ç½®ä¸€ç»„keyå…³è”å¯¹è±¡
- delete(key)ï¼šç§»é™¤ key çš„å…³è”å¯¹è±¡

```js
let myWeakmap = new WeakMap()
let myElement = document.getElementById('logo')

myWeakmap.set(myElement, { timesClicked: 0 })
myElement.addEventListener('click', function() {
  let logoData = myWeakmap.get(myElement)
  logoData.timesClicked++
}, false)
```
