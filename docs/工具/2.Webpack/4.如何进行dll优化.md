---
title: '如何进行dll优化'
date: 2020-03-26
permalink: 'webpack/dll'
tag:
  - webpack
categories:
  - webpack
---

`DLL` 全称是 `动态链接库`，是为软件在 windows 中实现共享函数库的一种实现方式。Webpack 也内置了该功能，为的就是可以将不经常改变的代码抽成一个共享的库，这个库在之后的编译过程中，会被引入到其他项目的代码中。使用步骤分成两部分:

- 打包一个 DLL 库
- 引入 DLL 库

## 打包一个 DLL 库

Webpack 内置了一个 DllPlugin 可以帮助我们打包一个 Dll 库文件:

```js
module.exports = {=
  entry: {
    // 第三方库
    vendors: ['react', 'react-dom', 'react-redux']
  },
  output: {
    // 输出的动态链接库的文件名称，[name] 代表当前动态链接库的名称，
    path: resolve('dist/dll'),
    filename: '[name].dll.js',
    // library必须和后面dllplugin中的name一致 后面会说明
    library: '[name]_dll_[hash]',
    clean: true,
  },
  plugins: [
    // 接入 DllPlugin
    new webpack.DllPlugin({
      // 动态链接库的全局变量名称，需要和 output.library 中保持一致
      // 该字段的值也就是输出的 manifest.json 文件 中 name 字段的值
      name: '[name]_dll_[hash]',
      // 描述动态链接库的 manifest.json 文件输出时的文件名称
      path: path.join(__dirname, 'dist/dll', '[name].manifest.json')
    }),
  ]
}
```

## 引入 DLL 库

使用 webpack 自带的 `DllReferencePlugin` 插件对 `mainfest.json` 映射文件进行分析，获取要使用的 DLL 库。

然后再通过 `AddAssetHtmlPlguin` 插件，将我们打包的 DLL 库引入到 Html 模块中:

```js
module.exports = {
  // ...
  plugins: [
    new webpack.DllReferencePlugin({
      context: path.reslove(__dirname, './dll/dll.react.js'),
      mainfest: path.reslove(__dirname, './dll/react.mainfest.json')
    }),
    new AddAssetHtmlPlugin({
      outputPath: './auto',
      filepath: path.reslove(__dirname, './dll/dll.react.js')
    })
  ]
  //
}
```
