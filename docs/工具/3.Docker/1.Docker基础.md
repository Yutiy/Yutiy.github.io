---
title: 'Docker基础'
date: 2020-03-26
permalink: 'docker'
tag:
  - docker
categories:
  - docker
---

## image镜像

可以使用 `docker pull` 命令来从仓库中获取所需要的镜像。

```shell
// 从注册服务器registry.hub.docker.com 中的 ubuntu 仓库来下载标记为 12.04 的镜像
$ sudo docker pull registry.hub.docker.com/ubuntu:12.04

// 创建一个容器，让其中运行 bash 应用
$ sudo docker run -it ubuntu:12.04 /bin/bash

// 列出本地镜像
$ docker images

// 来提交更新后的副本
$ docker commit -m 'add some options' -a 'docker newbee' imageId targetRepo:tag
```

## Docker容器

守护态运行: **sudo docker run -d ubuntu:14.04 /bin/sh -c "while true; do echo hello world; sleep 1; done"**
获取容器输出信息: **sudo docker logs -f names**
终止容器运行: **sudo docker stop containerId**
查看容器列表(包含已终止的): **sudo docker ps -a**

重启容器: **sudo docker restart containerId**
删除容器: **sudo docker rm containerId**

导入容器: **cat ubuntu.tar | sudo docker import - test/ubuntu:v1.0**
导出容器: **sudo docker export containerId > [name].rar**

在使用 `-d` 参数后，容器会进入后台运行。此时如需要进入容器操作，可使用 `docker attach` 命令或 `nscenter` 工具等

## Volumes数据卷

```bash
// 创建一个 web 容器，并加载一个数据卷到容器的 /webapp 目录
sudo docker run -d -P --name web -v /webapp training/webapp python app.py

// 加载主机的 /src/webapp 目录到容器的 /opt/webapp 目录
sudo docker run -d -P --name web -v /src/webapp:/opt/webapp training/webapp python app.py

// 挂载数据卷的默认权限是读写, ro表示只读
sudo docker run -d -P --name web -v /src/webapp:/opt/webapp:ro
```

### 数据卷容器

如果你有一些持续更新的数据需要在容器之间共享，最好创建数据卷容器，其实就是一个正常的容器，专门用来提供数据卷供其它容器挂载的。

```bash
// 首先，创建一个命名的数据卷容器 dbdata：
sudo docker run -d -v /dbdata --name dbdata training/postgres echo Data-only container for postgres

// 在其他容器中使用 --volumes-from 来挂载 dbdata 容器中的数据卷
$ sudo docker run -d --volumes-from dbdata --name db1 training/postgres
$ sudo docker run -d --volumes-from dbdata --name db2 training/postgres
```

备份: **$ sudo docker run --volumes-from dbdata -v $(pwd):/backup ubuntu tar cvf /backup/backup.tar /dbdata**
恢复:
  **sudo docker run -v /dbdata --name dbdata2 ubuntu /bin/bash**
  **sudo docker run --volumes-from dbdata2 -v $(pwd):/backup busybox tar xvf /backup/backup.tar**

## Docker网络

