---
title: 'vue-router'
date: 2020-03-26
permalink: 'vue/router'
tag:
  - vue
categories:
  - vue
---

## route相关概念

路由可以简单理解成一个 `url` 的地址，用来展示不同的内容或者页面。

- 后端路由: 就是找到对应的文件地址，将文件经过一层物理转换，再输出到前端。每一次获取地址，都需要连接服务器重新加载(暂不考虑缓存)
- 前端路由: 相对后端路由来说复杂一点，分为 hash 模式和 history 模式
  - hash路由: 利用 `onhashchange` 事件，可以在 window 对象上监听这个事件，再匹配到对应的路由规则，渲染到页面
  - history路由: 利用 `history.pushState` API来完成 url 跳转而无须重新加载页面

## html-hash-route构建

首先分析一下要做什么:

1. 初始化完成监听原生 api 的 load 与 hashchange 事件，触发对应的地址
2. 监听后，需要匹配到对应的规则，拿到原来的路由地址，再去匹配对应的路由地址，触发其回调函数

```js
class Router {
  constructor() {
    this.routes = {}
    this.init()
  }

  init() {
    window.addEventListener('load', this.refresh.bind(this), false)
    window.addEventListener('hashchange', this.refresh(this), false)
  }

  refresh() {
    let path = location.hash
    this.routes[path]()
  }

  route(path, cb) {
    this.routes['#' + path] = cb || function() {}
  }
}
```

然后在页面上面，对应的路由跳转对应的路由地址，简单的 hash 处理就完成了:

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>html-hash-route</title>
</head>
<body>
  <div id="app" class="body">
    <div class="header">Router</div>
    <div class="main">
      <div class="nav">
        <a href="#/" class="tag">首页</a>
        <a href="#/product" class="tag">商品</a>
        <a href="#/order" class="tag">订单</a>
      </div>

      <div id="content" class="content">
        这是首页
      </div>
    </div>
  </div>

  <script>
    window.onload = function() {
      const content = document.querySelector('#content')
      const router = new Router()

      router.route("/", function() {
        content.innerHTML = '这是首页'
      })
      router.route("/product", function() {
        content.innerHTML = '这是商品页'
      })
      router.route("/order", function() {
        content.innerHTML = '这是订单页'
      })
    }
  </script>
</body>
</html>
```

## vue-router构建

根据 vue-router 使用方法，分析一下其中到底有些什么:

- 首先 `Vue.use(router)`，说明源码中暴露了自己的 install 方法
- 根据 `new Router({ routes: [] })`，说明源码中暴露了一个对象，并且接收了 routes 作为参数
- 接收到 routes 参数后，需要保存对应的页面内容，方便下次触发路由时，再跳转到对应的内容

因此构造出基本路由类:

```js
class VueRouter {
  constructor(options) {
    this.routes = options.routes || []
    this.routesMap = this.createMap(this.routes)
  }

  createMap(routes) {
    return routes.reduce((prev, curr) => {
      prev[curr.path] = curr.component
      return prev
    }, {})
  }
}

VueRouter.install = function() {}
export default VueRouter
```

### 存储当前路由值

